<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VoIP Shop — Shopping Cart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- reCAPTCHA v3 (standard) — keep ONLY this loader -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LcI2rUrAAAAADaW9lGy3WZfBS-KzmnhWpOlcSVw"></script>

  <!-- Diagnostic helper (optional) -->
  <script>
    window.__rcDiag = async function(action='send_quote'){
      try {
        console.log('[rc] grecaptcha type:', typeof grecaptcha);
        const ready = new Promise((resolve)=>grecaptcha.ready(resolve));
        const timeout = new Promise((_,rej)=>setTimeout(()=>rej(new Error('ready_timeout')),8000));
        await Promise.race([ready, timeout]);
        const t = await grecaptcha.execute('6LcI2rUrAAAAADaW9lGy3WZfBS-KzmnhWpOlcSVw', {action});
        console.log('[rc] token len:', t.length, 'sample:', t.slice(0,25)+'…');
        return t;
      } catch (e) {
        console.error('[rc] failure:', e);
        throw e;
      }
    };
  </script>

  <!-- Performance hints -->
  <meta http-equiv="x-dns-prefetch-control" content="on" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>

  <style>
    /* =========================
       Base + Performance
       ========================= */
    :root{
      --ink:#111827;
      --muted:#4b5563;
      --muted-2:#6b7280;
      --bg:#f5f5f7;
      --border:#e5e7eb;
      --blue:#0B63E6;
      --blue-50:#EFF5FF;
      --teal:#0E5B52;
      --teal-50:#E8F4F2;
      --shadow:0 6px 18px rgba(0,0,0,.06);
      --container-max:1280px;
      --container-pad:16px;
      --gap:24px;
    }
    html, body{
      font-family:-apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
      background:var(--bg); color:var(--ink);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      margin:0; padding:0;
    }

    /* Paint large sections on demand & reserve size to avoid CLS */
    main, aside, section{ content-visibility:auto; contain-intrinsic-size: 800px; }

    .tabular-nums{ font-variant-numeric:tabular-nums; }

    /* =========================
       Header + Intro
       ========================= */
    .intro-wrap{
      max-width:var(--container-max);
      margin:0 auto;
      padding:24px var(--container-pad) 0;
    }
    .intro-wrap h1{
      font-weight:600; color:var(--ink);
      font-size:1.75rem; line-height:1.2;
      margin:0 0 .5rem 0;
    }
    @media (min-width:640px){ .intro-wrap h1{ font-size:2rem; } }
    .breadcrumb{
      font-size:0.875rem; color:var(--muted-2); margin-top:.5rem;
    }
    .breadcrumb a{ color:var(--blue); text-decoration:none; }
    .breadcrumb a:hover{ text-decoration:underline; }

    /* =========================
       Container grid (mobile-first)
       ========================= */
    .container{
      width:100%;
      max-width:var(--container-max);
      margin:0 auto;
      padding:24px var(--container-pad);
      display:grid;
      grid-template-columns:1fr;
      gap:var(--gap);
    }
    @media (min-width:1024px){
      .container{
        grid-template-columns:2fr 1fr; /* 8 / 4 feel */
        gap:32px;
      }
    }

/* Left/Right columns */
.col-main { display: block; }
.col-aside { display: block; }

    /* =========================
       Table-like rows (responsive grid)
       ========================= */
    .table-head{ background:#fff; }
    .table-row{
      background:#fff; border-radius:14px; border:1px solid var(--border);
      display:grid; gap:12px; padding:12px;
    }
    /* Mobile-first: 2 cols — name full row; qty left; total right */
    @media (max-width: 767.98px){
      .table-row{ grid-template-columns: 1fr auto; align-items:center; }
      .table-row [data-cell="name"]  { grid-column:1/-1; }
      .table-row [data-cell="qty"]   { grid-column:1/2; justify-self:start; }
      .table-row [data-cell="total"] { grid-column:2/3; justify-self:end; text-align:right; }
    }
    /* Tablet+Desktop: 12-col grid — name(1-8), qty(9-10), total(11-12) */
    @media (min-width:768px){
      .table-row{ grid-template-columns:repeat(12,minmax(0,1fr)); align-items:center; }
      .table-row [data-cell="name"]  { grid-column:1 / span 8; }
      .table-row [data-cell="qty"]   { grid-column:9 / span 2; justify-self:start; }
      .table-row [data-cell="total"] { grid-column:11 / span 2; justify-self:end; text-align:right; }
    }

    /* Qty area */
    .table-row [data-cell="qty"]{ display:flex; justify-content:flex-start; align-items:center; white-space:nowrap; }
    :root { --qty-pill-number-nudge:-14px; }
    .qty-pill{ display:inline-flex; align-items:center; height:28px; border-radius:10px; background:#fff; border:1px solid var(--border); overflow:hidden; transform:translateX(var(--qty-pill-number-nudge)); }
    .qty-pill>*+*{ border-left:1px solid #eaecef; }
    .qty-btn{ width:28px; height:100%; display:grid; place-items:center; background:transparent; border:0; font-weight:700; font-size:14px; line-height:1; color:#0f172a; cursor:pointer; transition:background .12s ease, transform .05s ease; -webkit-tap-highlight-color:transparent; }
    .qty-btn:hover{ background:#f2f4f7; } .qty-btn:active{ transform:scale(.98); } .qty-btn:disabled{ opacity:.4; pointer-events:none; }
    .qty-value{ min-width:28px; text-align:center; font-variant-numeric:tabular-nums; font-weight:600; font-size:13px; line-height:1; }

    .qty-plain{ display:inline-flex; align-items:center; justify-content:center; height:28px; min-width:34px; padding:0 8px; border-radius:10px; border:1px solid var(--border); background:#fff; font-weight:600; font-size:13px; line-height:1; color:#0f172a; }

    .chip{ display:inline-flex; align-items:center; height:20px; padding:0 8px; gap:.3rem; border-radius:9999px; font-size:11px; line-height:1; border:1px solid var(--border); background:#fff; color:#4b5563; box-shadow:none; }
    .chip-primary{ background:#eef4ff; border-color:#e0e7ff; color:#1e40af; }
    .chip-ghost{ background:#f3f4f6; border-color:var(--border); color:#4b5563; }

    .js-subtext{ margin-top:.25rem; }

    /* Totals rows (inside table) */
    .table-total{ background:#fff; border:1px solid var(--border); border-radius:14px; }
    .table-total .label{ font-size:.95rem; color:#4b5563; font-weight:600; }
    .table-total .amount{ text-align:right; font-weight:700; color:#111827; }

    @media (max-width:480px){
      :root{ --qty-pill-number-nudge:-12px; }
      .qty-pill{ height:26px; } .qty-btn{ width:26px; font-size:13px; } .qty-value{ min-width:26px; font-size:12px; }
      .qty-plain{ height:26px; min-width:30px; padding:0 6px; font-size:12px; }
      .chip{ height:18px; font-size:10.5px; }
    }

    #onceoff-total, #monthly-total{ position:relative; right:var(--total-nudge, 0px); }
    @media (max-width: 479.98px){ :root{ --total-nudge:8px; } }

    /* =========================
       Colourful summary cards (right column)
       ========================= */
    .card{ background:#fff; border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow); }
    .card-h{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:14px 16px; border-bottom:1px solid #f0f2f5; }
    .card-b{ padding:16px; }

    /* Blue accent (Amount to Pay Now) */
    .card-blue{ background:linear-gradient(180deg, var(--blue-50), #fff 38%); border-color:#dfe9ff; }
    .card-blue .pill{ background:#0b63e61a; color:var(--blue); border:1px solid #cfe1ff; }

    /* Teal accent (Your Monthly Invoice) */
    .card-teal{ background:linear-gradient(180deg, var(--teal-50), #fff 38%); border-color:#d4ebe8; }
    .card-teal .pill{ background:#0e5b5218; color:#0e5b52; border:1px solid #cfe7e3; }

    .pill{ display:inline-flex; align-items:center; gap:.4rem; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:600; }

    .metric{ display:flex; align-items:baseline; justify-content:space-between; gap:12px; }

    /* Inputs & buttons */
    button{
      width:100%;
      border-radius:12px;
      padding:12px 14px;
      font-weight:700;
      color:#fff;
      border:0;
      cursor:pointer;
      transition: background .15s ease, box-shadow .15s ease, transform .05s ease;
    }
    button:hover{ filter:brightness(.98); }
    button:active{ transform: translateY(1px); }
    .btn-primary{ background:#0B63E6; }
    .btn-dark{ background:#111827; font-weight:600; }

    input[type="text"], input[type="email"], input[type="tel"]{
      width:100%;
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px 14px;
      font-size:15px;
      outline:none;
    }
    input:focus{ box-shadow:0 0 0 3px rgba(11,99,230,.15); border-color:#0B63E6; }

    /* Footer */
    footer .muted { color:#6b7280; text-decoration:none; }
    footer .muted:hover { color:#111827; text-decoration:underline; }

    /* Reduced motion */
    @media (prefers-reduced-motion:reduce){
      *{ animation:none!important; transition:none!important; scroll-behavior:auto!important; }
    }
  </style>
</head>

<body class="min-h-screen" style="display:flex;flex-direction:column">
  <!-- ✅ Universal navbar injected by site.js -->
  <div id="nav-slot"></div>
  <script src="./scripts/site.js" defer></script>
  <!-- ✅ End navbar -->

  <section class="intro-wrap">
    <h1>Shopping Cart</h1>
    <nav class="breadcrumb" aria-label="breadcrumb">
      <a href="index.html">Home</a>
      <span style="margin:0 .5rem;color:#9ca3af">/</span>
      <span aria-current="page">Shopping Cart</span>
    </nav>
  </section>

  <main class="container">
    <!-- Left: tables -->
    <div class="col-main">
      <!-- Once-off -->
      <section>
        <h2 style="font-size:1.1rem;font-weight:600;color:#111827;margin:0 0 .75rem 0">Once-off Charges</h2>
        <div id="onceoff-rows" class="space-y-3"></div>
        <div class="mt-3">
          <div class="table-total" style="display:grid;grid-template-columns:repeat(12,minmax(0,1fr));align-items:center;padding:16px">
            <div class="label" style="grid-column:1 / span 10">Total (once-off)</div>
            <strong id="onceoff-total" class="amount tabular-nums" style="grid-column:11 / span 2" aria-live="polite">R 0</strong>
          </div>
        </div>
      </section>

      <!-- Monthly -->
      <section style="margin-top:32px">
        <h2 style="font-size:1.1rem;font-weight:600;color:#111827;margin:0 0 .75rem 0">Recurring Monthly Charges</h2>
        <div id="monthly-rows" class="space-y-3"></div>
        <div class="mt-3">
          <div class="table-total" style="display:grid;grid-template-columns:repeat(12,minmax(0,1fr));align-items:center;padding:16px">
            <div class="label" style="grid-column:1 / span 10">Total (monthly)</div>
            <strong id="monthly-total" class="amount tabular-nums" style="grid-column:11 / span 2">R 0
              <span style="color:#6b7280;font-size:12px">/month</span>
            </strong>
          </div>
        </div>
      </section>
    </div>

    <!-- Right: summary -->
    <aside class="col-aside">
      <!-- Card 1: Pay Now (blue accent) -->
      <div class="card card-blue">
        <header class="card-h">
          <h3 style="margin:0;font-size:1.125rem;font-weight:700;color:#0b1a33">Amount to Pay Now</h3>
          <span class="pill">First month</span>
        </header>
        <div class="card-b">
          <p style="margin:0;color:#516072;font-size:.95rem">This is your first payment, covering once-off setup and your first month’s service.</p>
          <dl class="mt-4" style="margin-top:16px;display:flex;flex-direction:column;gap:12px;font-size:.95rem">
            <div class="metric">
              <dt style="color:#4b5563">Once-off Charges (ex VAT)</dt>
              <dd id="subtotal-onceoff" class="tabular-nums" style="font-weight:600;margin:0">R0,00</dd>
            </div>
            <div class="metric">
              <dt style="color:#4b5563">Monthly Charges (first month, ex VAT)</dt>
              <dd id="subtotal-monthly" class="tabular-nums" style="font-weight:600;margin:0">R0,00</dd>
            </div>
          </dl>
          <div style="margin-top:16px;border-top:1px solid #e8eefc;padding-top:12px">
            <div class="metric">
              <span style="color:#4b5563;font-size:.95rem">VAT @ 15%</span>
              <span id="vat-first-month" class="tabular-nums" style="font-size:.95rem;font-weight:600">R0,00</span>
            </div>
            <div class="metric" style="margin-top:6px">
              <span style="font-size:1.05rem;font-weight:700;color:#0b1a33">Total to Pay Now</span>
              <span id="total-first-month" class="tabular-nums" style="font-size:1.15rem;font-weight:700;color:#0b1a33">R0,00</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Card 2: Ongoing Invoice (teal accent) -->
      <div class="card card-teal" style="margin-top:16px">
        <header class="card-h">
          <h3 style="margin:0;font-size:1.125rem;font-weight:700;color:#09342f">Your Monthly Invoice</h3>
          <span class="pill">From month 2</span>
        </header>
        <div class="card-b">
          <p style="margin:0;color:#4c635e;font-size:.95rem">From the second month onward, you’ll only pay the recurring monthly charges.</p>
          <div class="metric" style="margin-top:16px;font-size:.95rem">
            <span style="color:#4b5563">Monthly Subtotal (ex VAT)</span>
            <span id="monthly-invoice-subtotal" class="tabular-nums" style="font-weight:600">R0,00</span>
          </div>
          <div class="metric" style="margin-top:12px;border-top:1px solid #dfeceb;padding-top:12px">
            <span style="font-size:1.05rem;font-weight:700;color:#09342f">Monthly Total (incl VAT)</span>
            <span id="monthly-invoice-total" class="tabular-nums" style="font-size:1.15rem;font-weight:700;color:#09342f">R0,00</span>
          </div>
        </div>
      </div>

      <!-- Card 3: Your Details + Actions -->
      <div class="card" style="margin-top:16px">
        <div class="card-b">
          <h3 style="margin:0 0 12px 0;font-size:1.125rem;font-weight:700;color:#111827">Your Details</h3>
          <form id="quick-checkout-form" class="mt-4" novalidate style="margin-top:16px;display:flex;flex-direction:column;gap:16px">
            <fieldset style="border:0;padding:0;margin:0;display:flex;flex-direction:column;gap:12px">
              <label style="display:block">
                <span style="display:block;font-size:.9rem;color:#374151">Business name</span>
                <input type="text" name="businessName" autocomplete="organization" required placeholder="e.g. Acme (Pty) Ltd" />
              </label>
              <label style="display:block">
                <span style="display:block;font-size:.9rem;color:#374151">Email address</span>
                <input type="email" name="email" autocomplete="email" required placeholder="you@company.co.za" />
              </label>
              <label style="display:block">
                <span style="display:block;font-size:.9rem;color:#374151">Phone number</span>
                <input type="tel" name="phone" inputmode="tel" autocomplete="tel-national" required placeholder="e.g. 067 922 8256" />
              </label>
            </fieldset>
            <div style="display:flex;flex-direction:column;gap:12px">
              <button type="submit" class="btn-primary">Complete Order</button>
              <button type="button" id="email-quote-btn" class="btn-dark">Email Me Quote</button>
            </div>
          </form>
        </div>
      </div>
    </aside>
  </main>

  <footer style="margin-top:auto;background:#fff;border-top:1px solid var(--border)">
    <div style="max-width:var(--container-max);margin:0 auto;padding:24px var(--container-pad);text-align:center;font-size:14px;color:#6b7280">
      <div style="margin-bottom:8px">Thank you for your order! Our team will contact you within 24 hours to confirm details and arrange delivery.</div>
      <div style="margin-bottom:8px">Need help? <a href="mailto:sales@voipshop.co.za" style="color:var(--blue);text-decoration:none">Email us</a> or call <a href="tel:0683510074" style="color:var(--blue);text-decoration:none">068 351 0074</a>.</div>
      <div style="margin-bottom:8px"><a href="privacy.html" class="muted">Privacy Policy</a> · <a href="terms.html" class="muted">Terms of Service</a> · <a href="legal.html" class="muted">Refund Policy</a></div>
      <div style="color:#9ca3af">© 2025 VoIP Shop. All rights reserved.</div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="./scripts/checkout.js" defer></script>

  <!-- Monthly invoice sync (unchanged, just deferred) -->
  <script>
    (function(){
      const VAT_RATE = 0.15;
      function parseZAR(text){
        const cleaned = String(text||"").replace(/[^\d,.-]/g,"").replace(/\.(?=\d{3}\b)/g,"");
        const n = Number(cleaned.replace(",","."));
        return Number.isFinite(n)?n:0;
      }
      function formatZAR(n){
        const fixed=(Math.round(n*100)/100).toFixed(2);
        const [i,d]=fixed.split(".");
        const withSep=i.replace(/\B(?=(\d{3})+(?!\d))/g,".");
        return "R "+withSep+","+d;
      }
      function sync(){
        const subEl=document.getElementById("subtotal-monthly");
        const subOut=document.getElementById("monthly-invoice-subtotal");
        const totOut=document.getElementById("monthly-invoice-total");
        if(!subEl||!subOut||!totOut) return;
        const ex=parseZAR(subEl.textContent); const inc=ex*(1+VAT_RATE);
        subOut.textContent=formatZAR(ex);
        totOut.textContent=formatZAR(inc);
      }
      if(document.readyState==='loading'){
        document.addEventListener('DOMContentLoaded', sync);
      } else { sync(); }
      const subEl=document.getElementById('subtotal-monthly');
      if(subEl){
        new MutationObserver(sync).observe(subEl,{childList:true,characterData:true,subtree:true});
      }
      document.addEventListener('cart:recalculated', sync);
    })();
  </script>

  <!-- WhatsApp floater (kept) -->
  <a href="https://wa.me/27679228256?text=Hi%20VoIP%20Shop%2C%20I%20need%20help" target="_blank" rel="noopener"
     aria-label="Chat to VoIP Shop on WhatsApp"
     style="position:fixed;z-index:60;right:16px;bottom:16px;background:#25D366;color:#fff;
            border-radius:999px;padding:8px 12px;display:flex;gap:8px;align-items:center;
            box-shadow:0 10px 24px rgba(0,0,0,.16)">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"
         fill="currentColor" aria-hidden="true">
      <path d="M20.52 3.48A11.91 11.91 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.12.55 4.16 1.59 5.97L0 24
               l6.2-1.58A11.94 11.94 0 0 0 12 24c6.63 0 12-5.37 12-12
               0-3.19-1.24-6.2-3.48-8.52zM12 21.5c-1.9 0-3.73-.5-5.34-1.45l-.38-.22-3.68.94.98-3.59
               -.25-.37A9.46 9.46 0 0 1 2.5 12C2.5 6.76 6.76 2.5 12 2.5c2.52 0 4.9.98
               6.71 2.79A9.45 9.45 0 0 1 21.5 12c0 5.24-4.26 9.5-9.5 9.5zm5.37-7.13
               c-.3-.15-1.77-.87-2.05-.97-.27-.1-.47-.15-.67.15s-.77.97-.94
               1.17c-.17.2-.35.22-.65.07-.3-.15-1.26-.46-2.4-1.46-.89-.79-1.5-1.77-1.67-2.07
               -.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37
               -.02-.52-.07-.15-.67-1.62-.91-2.21-.24-.59-.48-.5-.67-.51h-.57
               c-.2 0 -.52 .07 -.79 .37s-1.04 1.02 -1.04 2.5
               1.07 2.9 1.22 3.1c.15 .2 2.1 3.2 5.1 4.5 .71 .3 1.27 .48 1.7
               .62 .71 .23 1.35 .2 1.86 .12 .57 -.08 1.77 -.72
               2.02 -1.42 .25 -.7 .25 -1.3 .17 -1.42 -.08 -.12 -.27 -.2 -.57 -.35z"/>
    </svg>
    <span style="font-size:14px;font-weight:600">Need help?</span>
  </a>
</body>
</html>
