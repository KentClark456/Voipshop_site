<!-- ======= Full-bleed Sticky Header with Mobile Hamburger (no Tailwind) ======= -->
<header
  style="
    width:100vw; margin-left:calc(50% - 50vw); margin-right:calc(50% - 50vw);
    position:sticky; top:0; z-index:50;
    background:rgba(255,255,255,.9); backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
    border-bottom:1px solid #e5e7eb; text-align:initial;
  "
>
  <style>
    /* ---- Desktop vs Mobile breakpoints ---- */

    /* Desktop/base: show desktop nav, hide burger & mobile bits */
    #desktop-nav{ display:inline-flex !important; }
    #menu-toggle{ display:none !important; }
    #mobile-nav{ display:none !important; }
    #mobile-quick{ display:none !important; }

    /* Mobile <900px: flip visibility */
    @media (max-width: 899px){
      #desktop-nav{ display:none !important; }
      #menu-toggle{ display:inline-flex !important; }
      #mobile-nav{ display:block !important; }
      #mobile-quick{ display:inline-flex !important; }
    }

    /* ---- Mobile panel + overlay ---- */
    #mobile-nav-overlay {
      position:fixed; inset:0; background:rgba(0,0,0,.25);
      opacity:0; pointer-events:none; transition:opacity .2s ease;
    }
    #mobile-nav-panel {
      position:fixed; top:0; right:0; height:100vh; width:min(86vw, 360px);
      background:#fff; box-shadow:-12px 0 24px rgba(0,0,0,.12);
      transform:translateX(100%); transition:transform .25s ease;
      display:flex; flex-direction:column; padding:16px 18px;
    }
    #mobile-nav-panel a {
      text-decoration:none; color:#111827; font:600 16px/1.2 system-ui; padding:12px 2px;
    }
    #mobile-nav-panel a:hover { color:#000; }
    #mobile-nav[data-open="true"] #mobile-nav-overlay { opacity:1; pointer-events:auto; }
    #mobile-nav[data-open="true"] #mobile-nav-panel { transform:translateX(0%); }

    /* ---- Buttons / icons ---- */
    .icon-btn {
      display:inline-flex; align-items:center; justify-content:center;
      height:36px; width:36px; border-radius:8px; border:1px solid #e5e7eb;
      background:#fff; color:#111; cursor:pointer;
    }
    .icon-btn:hover { background:#f9fafb; }
    .cart-link { position:relative; display:inline-flex; align-items:center; color:#0B63E6; text-decoration:none; }
    .cart-badge {
      position:absolute; top:-6px; right:-8px; background:#0B63E6; color:#fff;
      font:700 10px/1 system-ui; padding:2px 6px; border-radius:999px; display:none;
    }
    .cart-badge[data-show="true"] { display:inline-block; }

    /* Keep header internals boxed nicely */
    #hdr-row{
      width:100% !important; max-width:none !important; margin:0 !important;
      padding:12px 24px 12px 14px; box-sizing:border-box;
      display:flex; align-items:center; gap:16px; justify-content:space-between;
    }
    #desktop-nav a{
      color:#374151; font:500 14px/1.2 system-ui; text-decoration:none;
    }
    #desktop-nav a:hover{ color:#000; }
  </style>

  <div id="hdr-row">
    <!-- Left: Logo -->
    <a href="index.html" aria-label="VoIP Shop â€” Home"
       style="display:inline-flex; align-items:center; gap:10px; text-decoration:none; margin-left:6px;">
      <img src="Assets/Logo.png" alt="VoIPShop Logo" style="height:28px; width:auto; object-fit:contain; display:block;">
    </a>

    <!-- Right: Desktop nav + icons -->
    <nav id="desktop-nav" aria-label="Primary" style="margin-left:auto; align-items:center; gap:32px;">
      <a href="packages.html">Packages</a>
      <a href="build-solution.html">Custom Build</a>
      <a href="voice-services.html">Voice Services</a>
      <a href="mobile-app.html">Mobile Apps</a>
      <a href="contact.html">Contact Us</a>

      <!-- Desktop Cart -->
      <a href="checkout.html" title="Cart" class="cart-link">
        <svg viewBox="0 0 24 24" aria-hidden="true" style="height:20px; width:20px; display:block;">
          <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.5 7h13l-1.5-7M9 21a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="cart-badge" data-cart-count></span>
      </a>

      <!-- Desktop Account -->
      <a href="login.html" title="Account" aria-label="Account" style="display:inline-flex; align-items:center; color:#374151; text-decoration:none;">
        <svg viewBox="0 0 24 24" aria-hidden="true" style="height:20px; width:20px; display:block;">
          <circle cx="12" cy="7" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
          <path d="M5.5 21a6.5 6.5 0 0 1 13 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </a>
    </nav>

    <!-- Mobile: hamburger + quick icons -->
    <div id="mobile-quick" style="align-items:center; gap:10px; margin-left:auto;">
      <!-- Quick cart (mobile) -->
      <a href="checkout.html" title="Cart" class="cart-link" aria-label="Cart (mobile)">
        <svg viewBox="0 0 24 24" aria-hidden="true" style="height:22px; width:22px; display:block;">
          <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.5 7h13l-1.5-7M9 21a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="cart-badge" data-cart-count></span>
      </a>

      <!-- Hamburger -->
      <button id="menu-toggle" class="icon-btn" aria-label="Open menu" aria-controls="mobile-nav" aria-expanded="false">
        <svg id="burger-icon" viewBox="0 0 24 24" aria-hidden="true" style="height:20px; width:20px;">
          <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <svg id="close-icon" viewBox="0 0 24 24" aria-hidden="true" style="height:20px; width:20px; display:none;">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- ======= Mobile off-canvas ======= -->
<div id="mobile-nav" data-open="false" hidden>
  <div id="mobile-nav-overlay"></div>
  <aside id="mobile-nav-panel" role="dialog" aria-modal="true" aria-label="Navigation">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; padding:4px 2px 8px;">
      <strong style="font:700 14px/1 system-ui; color:#111827;">Menu</strong>
      <button id="menu-close" class="icon-btn" aria-label="Close menu">
        <svg viewBox="0 0 24 24" aria-hidden="true" style="height:18px; width:18px;">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <nav aria-label="Mobile Primary" style="display:flex; flex-direction:column; gap:2px; padding-top:6px;">
      <a href="packages.html">Packages</a>
      <a href="build-solution.html">Custom Build</a>
      <a href="voice-services.html">Voice Services</a>
      <a href="mobile-app.html">Mobile Apps</a>
      <a href="contact.html">Contact Us</a>

      <hr style="border:none; border-top:1px solid #e5e7eb; margin:12px 0;">
      <a href="checkout.html" style="display:flex; align-items:center; gap:10px;">
        <span>Cart</span>
        <span class="cart-badge" data-cart-count></span>
      </a>
      <a href="login.html" style="display:flex; align-items:center; gap:10px;">Account</a>
    </nav>
  </aside>
</div>

<!-- ======= Behavior ======= -->
<script>
(function () {
  // ---------- Cart badge logic (desktop + mobile) ----------
  function safeParse(key) {
    try { return JSON.parse(localStorage.getItem(key) || 'null'); } catch { return null; }
  }
  function getCartCount() {
    const custom   = safeParse('voip:customBuild') || [];
    const selected = safeParse('voip:selectedPackage') || {};
    if (Array.isArray(custom) && custom.length > 0) {
      return custom.reduce((sum, it) => sum + (Number(it.qty) || 0), 0);
    }
    if (Array.isArray(selected.devices)) {
      return selected.devices.reduce((sum, d) => sum + (Number(d.number) || 0), 0);
    }
    return 0;
  }
  function updateCartBadges() {
    const n = getCartCount();
    document.querySelectorAll('[data-cart-count]').forEach(el => {
      if (n > 0) { el.textContent = n; el.setAttribute('data-show', 'true'); }
      else { el.textContent = ''; el.removeAttribute('data-show'); }
    });
  }
  document.addEventListener('DOMContentLoaded', updateCartBadges);
  window.addEventListener('storage', (e) => {
    if (['voip:customBuild','voip:selectedPackage'].includes(e.key)) updateCartBadges();
  });

  // ---------- Mobile menu toggle ----------
  const root = document.documentElement;
  const mobileNav = document.getElementById('mobile-nav');
  const panel = document.getElementById('mobile-nav-panel');
  const overlay = document.getElementById('mobile-nav-overlay');
  const btnOpen = document.getElementById('menu-toggle');
  const btnClose = document.getElementById('menu-close');
  const iconBurger = document.getElementById('burger-icon');
  const iconClose  = document.getElementById('close-icon');

  function setOpen(open) {
    mobileNav.dataset.open = String(open);
    mobileNav.hidden = !open;
    if (btnOpen) btnOpen.setAttribute('aria-expanded', String(open));
    if (iconBurger) iconBurger.style.display = open ? 'none' : 'block';
    if (iconClose)  iconClose.style.display  = open ? 'block' : 'none';
    root.style.overflow = open ? 'hidden' : '';
    if (open) {
      setTimeout(() => panel.querySelector('a,button,[tabindex]')?.focus(), 0);
    } else {
      setTimeout(() => btnOpen?.focus(), 0);
    }
  }

  function toggle() { setOpen(mobileNav.dataset.open !== 'true'); }

  btnOpen?.addEventListener('click', toggle);
  btnClose?.addEventListener('click', () => setOpen(false));
  overlay?.addEventListener('click', () => setOpen(false));

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileNav.dataset.open === 'true') setOpen(false);
  });

  panel?.addEventListener('click', (e) => {
    const a = e.target.closest('a[href]');
    if (a) setOpen(false);
  });

  // ---------- Highlight current page ----------
  function highlightActive(container) {
    if (!container) return;
    const current = location.pathname.replace(/index\.html$/, '').replace(/\/+$/, '');
    container.querySelectorAll('a[href]').forEach(a => {
      const href = new URL(a.getAttribute('href'), location.href)
        .pathname.replace(/index\.html$/, '').replace(/\/+$/, '');
      if (href === current) a.style.color = '#000';
    });
  }
  highlightActive(document.getElementById('desktop-nav'));
  highlightActive(panel);
})();
</script>
