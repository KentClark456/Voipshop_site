<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TKKDK54F');</script>
  <!-- End Google Tag Manager -->

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VoIP Shop - Build a Solution</title>
  <meta name="description" content="Build a custom PBX setup: choose reception, desk and cordless phones. Professional install, remote support, and simple monthly service." />

  <!-- Preload CSS for faster first paint + fallback -->
  <link rel="preload" as="style" href="style.css" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="style.css"></noscript>

  <link rel="icon" type="image/png" href="Assets/icon _voice_.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <!-- Page-scoped responsive + perf polish -->
  <style>
    :root{
      --rail-w: 260px;
      --navH: 72px; /* if your navbar height changes, update via JS if needed */
    }

    /* Prevent sticky ancestors from being clipped or broken */
    html, body { height: auto; min-height: 100%; overflow-y: auto; }
    body { -webkit-tap-highlight-color: transparent; }

    /* Clear anchor jumps below sticky UI */
    section[id] { scroll-margin-top: max(56px, var(--navH)); }

    /* ====== LAYOUT: Rail + Content ====== */
    .flow-layout{
      display: grid;
      grid-template-columns: var(--rail-w) minmax(0,1fr);
      align-items: start;
      gap: 0;
    }

    /* Sticky rail (desktop) */
    .rail{
      position: sticky;
      top: var(--navH);
      align-self: start;
      max-height: calc(100dvh - var(--navH));
      overflow: auto;
      background: #fff;
      border-right: 1px solid #e5e7eb;
      padding: 10px;
      z-index: 30;
      contain: layout paint;
    }
    .rail .rail-toggle{
      display: inline-flex; align-items:center; justify-content:center;
      width: 38px; height: 38px; border-radius: 10px;
      border: 1px solid #e5e7eb; background:#fff; cursor: pointer;
    }
    .rail-list{
      list-style: none; margin: 8px 0 0; padding: 0;
      display: flex; flex-direction: column; gap: 6px;
    }
    .rail-list a{
      display: grid; grid-template-columns: 22px auto; align-items:center;
      gap: 10px; padding: 10px 12px; border-radius: 12px;
      color: #111827; text-decoration: none; border: 1px solid transparent;
    }
    .rail-list a:hover{ background:#f9fafb; border-color:#e5e7eb; }
    .rail-list a.is-active{ background:#eef5ff; border-color:#cfe2ff; color:#0b63e6; }

    /* Icons */
    .rail .icon { width: 20px; height: 20px; }

    /* CONTENT column */
    .content, .hardware-step, .package-container-outer, .hardware-container-outer {
      min-width: 0; overflow: visible !important; transform: none !important; contain: initial !important;
    }

    /* ====== MOBILE/TABLET ADAPTATIONS ====== */
    @media (max-width: 1023.98px){
      .flow-layout{ grid-template-columns: 1fr; }
      .rail{
        position: sticky; top: 0; max-height: none; border-right: none; border-bottom: 1px solid #e5e7eb;
        padding: 8px 10px;
      }
      .rail .rail-toggle{ display: none; } /* phones: horizontal scroller is enough */
      .rail-list{
        flex-direction: row; gap: 6px; overflow-x: auto; overflow-y: hidden;
        -webkit-overflow-scrolling: touch; scroll-snap-type: x proximity;
      }
      .rail-list a{ white-space: nowrap; scroll-snap-align: start; }
    }

    /* iPad toggle (optional collapse) */
    @media (min-width: 768px) and (max-width: 1023.98px){
      .rail .rail-toggle{ display: inline-flex; margin-bottom: 6px; }
      .rail[data-collapsed="true"] .rail-list{ display: none; }
    }

    /* ====== SECTION WRAPPERS ====== */
    .package-container-outer{ max-width: 1200px; margin-inline: auto; padding-inline: 1rem; }
    @media (min-width: 640px){ .package-container-outer{ padding-inline: 1.5rem; } }
    @media (min-width: 1024px){ .package-container-outer{ padding-inline: 2rem; } }

    .hardware-container-outer{ max-width: 1200px; margin-inline: auto; padding-inline: 1rem; }
    @media (min-width: 640px){ .hardware-container-outer{ padding-inline: 1.5rem; } }
    @media (min-width: 1024px){ .hardware-container-outer{ padding-inline: 2rem; } }

    .hardware-section-title{
      display:flex; align-items:center; gap:10px;
      font-weight: 600; color:#111827; margin: 18px 0 12px; padding: 0 2px;
    }
    .hardware-section-title .highlighted-text{
      background:#eef5ff; color:#0b63e6; border:1px solid #cfe2ff;
      padding: 4px 10px; border-radius: 999px; font-size: .95rem;
    }
    .hardware-section-title .separator{ color:#d1d5db; }
    .hardware-section-title .subtitle{ color:#6b7280; font-weight: 500; font-size:.95rem; }

    .hardware-divider{ border: 0; border-top: 1px solid #e5e7eb; margin: 16px 0 8px; }

    /* ====== GRID for cards your JS will render ====== */
    .hardware-container{
      display: grid; gap: 12px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 480px){ .hardware-container{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (min-width: 900px){ .hardware-container{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (min-width: 1200px){ .hardware-container{ grid-template-columns: repeat(3, minmax(0,1fr)); } }

    /* ====== PERF: only paint sections when needed ====== */
    .hardware-step{
      content-visibility: auto;
      contain-intrinsic-size: 700px 1000px; /* rough reserve to avoid CLS */
      padding-block: 4px;
    }

    /* Animations (respect reduced motion) */
    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
    }

    /* Intro spacing on small screens */
    #intro .border-t{ border-color: rgba(229,231,235,.6); }
  </style>

  <!-- Keep your original nuclear override (now redundant but harmless)
       Retained to match your environment and ensure sticky isn't clipped -->
  <style id="sticky-rail-nuclear">
    .flow-layout{ overflow: visible !important; transform: none !important; contain: initial !important; }
  </style>
</head>

<body class="bg-gray-100 text-black">
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKKDK54F" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>

  <!-- Navbar + Tailwind injection -->
  <script src="./scripts/site.js" defer></script>

  <!-- Main layout -->
  <div class="flow-layout">
    <!-- Collapsible Left Rail -->
    <aside class="rail" data-state="expanded" aria-label="Builder navigation">
      <button class="rail-toggle" aria-expanded="true" aria-controls="rail-list" title="Collapse">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 7h16M4 12h16M4 17h10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
        </svg>
        <span class="sr-only">Toggle navigation</span>
      </button>

      <ul id="rail-list" class="rail-list">
        <li>
          <a href="#switchboards" data-target="switchboards" class="is-active">
            <svg class="icon" aria-hidden="true"><use href="#icon-reception"/></svg>
            <span class="label">Reception Phones</span>
          </a>
        </li>
        <li>
          <a href="#desk-phones" data-target="desk-phones">
            <svg class="icon" aria-hidden="true"><use href="#icon-desk"/></svg>
            <span class="label">Desk Phones</span>
          </a>
        </li>
        <li>
          <a href="#cordless" data-target="cordless">
            <svg class="icon" aria-hidden="true"><use href="#icon-cordless"/></svg>
            <span class="label">Cordless Phones</span>
          </a>
        </li>
        <li>
          <a href="#step-2" data-target="step-2" class="final-step">
            <svg class="icon" aria-hidden="true"><use href="#icon-port"/></svg>
            <span class="label">Step 2: Porting</span>
          </a>
        </li>
      </ul>
    </aside>

    <!-- CONTENT -->
    <div class="content">
      <!-- Step 1 – Minimal / Apple-style -->
      <section id="intro" class="bg-gray-100">
        <div class="max-w-2xl mx-auto px-6 sm:px-6 lg:px-8 pt-8 pb-6 text-center">
          <div class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-[#0A84FF] to-[#0071E3] px-3 py-1
                      text-[10px] font-medium uppercase tracking-[0.18em] text-white
                      shadow-sm ring-1 ring-white/20">
            <span class="inline-block h-1.5 w-1.5 rounded-full bg-white/95"></span>
            Step 1
          </div>

          <h1 class="mt-3 text-[28px] sm:text-[34px] leading-tight font-semibold tracking-tight text-gray-900">
            Choose your hardware
          </h1>

          <p class="mt-2 text-[13px] text-gray-500">
            35c/min local · 55c/min mobile · International varies
          </p>

          <div class="mt-6 border-t"></div>
        </div>
      </section>

      <!-- Animation helpers (kept for compatibility) -->
      <style>
        @keyframes fadeInUp { 0%{opacity:0;transform:translateY(12px);} 100%{opacity:1;transform:translateY(0);} }
        .animate-fadeInUp { opacity:0; animation: fadeInUp .6s ease-out forwards; }
        .delay-100 { animation-delay:.1s; } .delay-200 { animation-delay:.2s; } .delay-300 { animation-delay:.3s; }
      </style>

      <!-- Switchboards -->
      <section class="hardware-step" id="switchboards">
        <div class="package-container-outer">
          <h2 class="hardware-section-title">
            <span class="highlighted-text">Reception Phones</span>
            <span class="separator">|</span>
            <span class="subtitle">Choose the Right Fit for Your Front Desk</span>
          </h2>
        </div>
        <div class="hardware-container-outer">
          <div class="hardware-container" id="switchboard-container"></div>
        </div>
        <div class="package-container-outer"><hr class="hardware-divider"></div>
      </section>

      <!-- Desk Phones -->
      <section class="hardware-step" id="desk-phones">
        <div class="package-container-outer">
          <h2 class="hardware-section-title">
            <span class="highlighted-text">Desk Phones</span>
            <span class="separator">|</span>
            <span class="subtitle">From Entry-Level to Executive</span>
          </h2>
        </div>
        <div class="hardware-container-outer">
          <div class="hardware-container" id="deskphone-container"></div>
        </div>
        <div class="package-container-outer"><hr class="hardware-divider"></div>
      </section>

      <!-- Cordless -->
      <section class="hardware-step" id="cordless">
        <div class="package-container-outer">
          <h2 class="hardware-section-title">
            <span class="highlighted-text">Cordless Phones</span>
            <span class="separator">|</span>
            <span class="subtitle">1 base station to every 8 cordless devices</span>
          </h2>
        </div>
        <div class="hardware-container-outer">
          <div class="hardware-container" id="cordless-container"></div>
        </div>
        <div class="package-container-outer"><hr class="hardware-divider"></div>
      </section>

      <!-- Step 2 / Totals (Apple-style card) -->
      <section id="step-2" class="bg-gray-200 py-12 sm:py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
          <div class="rounded-2xl border border-gray-200 bg-white shadow-sm p-6 sm:p-8 md:p-10 text-center">
            <p class="text-xs font-medium uppercase tracking-widest text-gray-500">Step 2</p>
            <h2 class="mt-2 text-2xl font-semibold tracking-tight text-gray-900">Proceed to Porting</h2>

            <!-- Black & white pills -->
            <div class="mt-4 flex flex-wrap items-center justify-center gap-3">
              <div class="inline-flex items-center rounded-full bg-black px-4 py-2 text-sm font-medium text-white">Installation Included</div>
              <div class="inline-flex items-center rounded-full bg-black px-4 py-2 text-sm font-medium text-white">Support Included</div>
              <div class="inline-flex items-center rounded-full bg-black px-4 py-2 text-sm font-medium text-white">Calls Excluded</div>
            </div>

            <div class="mt-6 flex flex-wrap items-center justify-center gap-3">
              <div class="inline-flex items-baseline gap-2 rounded-full border border-gray-200 bg-gray-50 px-4 py-3">
                <span class="text-[11px] uppercase tracking-widest text-gray-500">Monthly</span>
                <span id="total-footer-price" class="text-xl font-semibold text-gray-900">R 0</span>
                <span id="total-cost-period" class="text-gray-500">/mo.</span>
              </div>
              <div class="inline-flex items-baseline gap-2 rounded-full border border-gray-200 bg-gray-50 px-4 py-3">
                <span class="text-[11px] uppercase tracking-widest text-gray-500">Once-off</span>
                <span id="total-onceoff" class="text-xl font-semibold text-gray-900">R 0</span>
              </div>
            </div>

            <div class="mt-8">
              <a href="porting.html"
                 class="inline-flex items-center gap-3 rounded-xl bg-[#0071E3] px-6 py-3 text-white font-semibold tracking-tight
                        shadow-sm transition-colors duration-200 hover:bg-[#0066CC] focus:outline-none focus:ring-2 focus:ring-[#0071E3]/30">
                <span class="inline-flex items-center gap-2">Porting</span>
                <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6 12h12M12 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </div>

            <p class="mt-3 text-xs text-gray-500">Bring your numbers or get new ones.</p>

            <!-- Hidden legacy aliases -->
            <div class="sr-only" aria-hidden="true">
              <span id="proceed-total">R 0</span><span id="proceed-period">/mo.</span>
            </div>
          </div>
        </div>
      </section>
    </div> <!-- /.content -->
  </div> <!-- /.flow-layout -->

  <!-- External scripts (deferred, order preserved) -->
  <script src="scripts/packages.js" defer></script>
  <script src="scripts/solution-helpers.js" defer></script>
  <script src="scripts/common.js" defer></script>
  <script src="scripts/build-solution.js" defer></script> <!-- keep THIS last -->

  <!-- Page-scoped helpers -->
  <script>
    // Tablet rail toggle + remember state
    (function(){
      const rail = document.querySelector('.rail');
      const btn  = rail?.querySelector('.rail-toggle');
      if(!rail || !btn) return;

      const saved = sessionStorage.getItem('build-rail-collapsed');
      if(saved === 'true'){ rail.dataset.collapsed = 'true'; btn.setAttribute('aria-expanded','false'); }

      btn.addEventListener('click', ()=>{
        const collapsed = rail.dataset.collapsed === 'true' ? 'false' : 'true';
        rail.dataset.collapsed = collapsed;
        btn.setAttribute('aria-expanded', collapsed === 'true' ? 'false' : 'true');
        sessionStorage.setItem('build-rail-collapsed', collapsed);
      }, {passive:true});
    })();

    // Mark active link based on scroll position
    (function(){
      const links = Array.from(document.querySelectorAll('.rail-list a[href^="#"]'));
      const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
      if(!sections.length) return;

      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            const id = '#' + e.target.id;
            links.forEach(l => l.classList.toggle('is-active', l.getAttribute('href') === id));
          }
        });
      }, { rootMargin: '0px 0px -70% 0px', threshold: 0.01 });

      sections.forEach(s => io.observe(s));
    })();

    // Progressive hydrate hardware containers when close to viewport
    (function(){
      const containers = document.querySelectorAll('.hardware-container');
      const boot = (el)=>{ el.dataset.hydrated='true'; /* your existing JS will populate */ };
      if(!('IntersectionObserver' in window)){ containers.forEach(boot); return; }

      const io = new IntersectionObserver((entries, obs)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            boot(entry.target);
            obs.unobserve(entry.target);
          }
        });
      }, { rootMargin: '200px 0px', threshold: 0.01 });

      containers.forEach(c => io.observe(c));
    })();
  </script>

  <!-- SVG Icon Symbols -->
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <!-- Reception (desk bell) -->
      <symbol id="icon-reception" viewBox="0 0 24 24">
        <g stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75">
          <path d="M12 6.5v-2"/>
          <path d="M4 15a8 8 0 0 1 16 0H4Z"/>
          <path d="M2.5 18.5h19"/>
        </g>
      </symbol>

      <!-- Desk phone -->
      <symbol id="icon-desk" viewBox="0 0 24 24">
        <g stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75">
          <rect x="5" y="9" width="14" height="10" rx="2" />
          <path d="M8 6c0-1 1-2 2-2h4c1 0 2 1 2 2v3H8V6z" />
          <circle cx="9" cy="12" r="0.8" />
          <circle cx="12" cy="12" r="0.8" />
          <circle cx="15" cy="12" r="0.8" />
          <circle cx="9" cy="14.5" r="0.8" />
          <circle cx="12" cy="14.5" r="0.8" />
          <circle cx="15" cy="14.5" r="0.8" />
        </g>
      </symbol>

      <!-- Cordless + signal -->
      <symbol id="icon-cordless" viewBox="0 0 24 24">
        <g stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75">
          <rect x="8" y="5" width="8" height="14" rx="2"/>
          <path d="M11 8h2M10.5 17h3"/>
          <path d="M17 9.5c1.5.6 2.5 2 2.5 3.5s-1 2.9-2.5 3.5"/>
          <path d="M18.5 7.5c2.5 1 4 3.1 4 5.5s-1.5 4.5-4 5.5"/>
        </g>
      </symbol>

      <!-- Porting (swap) -->
      <symbol id="icon-port" viewBox="0 0 24 24">
        <g stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75">
          <path d="M7 7h10l-2-2"/>
          <path d="M17 17H7l2 2"/>
          <path d="M7 7v4M17 17v-4"/>
        </g>
      </symbol>
    </defs>
  </svg>
  <!-- ✅ Floating WhatsApp Help Button (all devices, mobile-optimised) -->
<a
  href="https://wa.me/27679228256?text=Hi%20VoIP%20Shop%2C%20I%20need%20help"
  target="_blank" rel="noopener"
  aria-label="Chat to VoIP Shop on WhatsApp"
  class="fixed z-[60] flex items-center gap-2 rounded-full bg-[#25D366] text-white
         px-4 py-2 shadow-lg hover:shadow-xl hover:opacity-90 transition
         focus:outline-none focus:ring-2 focus:ring-[#25D366]/50
         right-4 bottom-4
         md:right-5 md:bottom-5
         [padding-bottom:calc(0.5rem+env(safe-area-inset-bottom))]
         select-none"
  style="backdrop-filter:saturate(140%)"
>
  <!-- Icon (SVG) -->
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
       class="h-5 w-5 shrink-0" fill="currentColor" aria-hidden="true">
    <path d="M20.52 3.48A11.91 11.91 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.12.55 4.16 1.59 5.97L0 24l6.2-1.58A11.94 11.94 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.19-1.24-6.2-3.48-8.52zM12 21.5c-1.9 0-3.73-.5-5.34-1.45l-.38-.22-3.68.94.98-3.59-.25-.37A9.46 9.46 0 0 1 2.5 12C2.5 6.76 6.76 2.5 12 2.5c2.52 0 4.9.98 6.71 2.79A9.45 9.45 0 0 1 21.5 12c0 5.24-4.26 9.5-9.5 9.5zm5.37-7.13c-.3-.15-1.77-.87-2.05-.97-.27-.1-.47-.15-.67.15s-.77.97-.94 1.17c-.17.2-.35.22-.65.07-.3-.15-1.26-.46-2.4-1.46-.89-.79-1.5-1.77-1.67-2.07-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.67-1.62-.91-2.21-.24-.59-.48-.5-.67-.51h-.57c-.2 0-.52.07-.79.37s-1.04 1.02-1.04 2.5 1.07 2.9 1.22 3.1c.15.2 2.1 3.2 5.1 4.5.71.3 1.27.48 1.7.62.71.23 1.35.2 1.86.12.57-.08 1.77-.72 2.02-1.42.25-.7.25-1.3.17-1.42-.08-.12-.27-.2-.57-.35z"/>
  </svg>

  <span class="text-sm font-semibold">Need help?</span>
</a>
</body>
</html>
